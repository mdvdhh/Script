--[[ 
How to use

getgenv().TeamCheck = true
loadstring(game:HttpGet("https://raw.githubusercontent.com/mdvdhh/Script/refs/heads/main/PlayerLock"))()
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local TeamCheck = getgenv().TeamCheck or false
local LockedTarget = nil
local Highlight = nil
local Running = true

local N8WR5A2K = Instance.new("ScreenGui")
local Button = Instance.new("TextButton")

N8WR5A2K.Name = "N8WR5A2K"
N8WR5A2K.Parent = game.CoreGui
N8WR5A2K.ResetOnSpawn = false

Button.Size = UDim2.new(0, 120, 0, 40)
Button.Position = UDim2.new(0.5, -60, 0.9, 0)
Button.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
Button.Text = "Turn Off"
Button.TextColor3 = Color3.new(252, 0, 0)
Button.Font = Enum.Font.GothamBold
Button.TextSize = 18
Button.Parent = N8WR5A2K
Button.AutoButtonColor = true
Button.BorderSizePixel = 0
Button.BackgroundTransparency = 0.05
Button.Active = true
Button.Draggable = true

local function CreateHighlight(target)
    if Highlight then Highlight:Destroy() end
    Highlight = Instance.new("Highlight")
    Highlight.Adornee = target
    Highlight.FillColor = Color3.fromRGB(0, 170, 255)
    Highlight.OutlineColor = Color3.fromRGB(0, 255, 255)
    Highlight.FillTransparency = 0.5
    Highlight.OutlineTransparency = 0
    Highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    Highlight.Parent = target
end

local function GetMagnitude(part)
    return (LocalPlayer.Character.HumanoidRootPart.Position - part.Position).Magnitude
end

local function GetClosestPlayer()
    local closestPlayer = nil
    local shortestDistance = math.huge
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            if TeamCheck and player.Team == LocalPlayer.Team then
                continue
            end
            local distance = GetMagnitude(player.Character.HumanoidRootPart)
            if distance < shortestDistance then
                closestPlayer = player
                shortestDistance = distance
            end
        end
    end
    return closestPlayer
end

local connection
connection = RunService.RenderStepped:Connect(function()
    if not Running then return end
    local character = LocalPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end
    local closest = GetClosestPlayer()
    if closest and closest.Character and closest.Character:FindFirstChild("HumanoidRootPart") then
        if LockedTarget ~= closest then
            LockedTarget = closest
            CreateHighlight(closest.Character)
        end
        local hrp = character.HumanoidRootPart
        local targetPos = Vector3.new(closest.Character.HumanoidRootPart.Position.X, hrp.Position.Y, closest.Character.HumanoidRootPart.Position.Z)
        hrp.CFrame = CFrame.new(hrp.Position, targetPos)
    elseif Highlight then
        Highlight:Destroy()
        Highlight = nil
        LockedTarget = nil
    end
end)

Button.MouseButton1Click:Connect(function()
    Running = false
    if connection then connection:Disconnect() end
    if Highlight then Highlight:Destroy() end
    ScreenGui:Destroy()
end)
