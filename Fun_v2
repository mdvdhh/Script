local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local Notification = {}
Notification.__index = Notification

local function makeCorner(obj, radius)
	local c = Instance.new("UICorner")
	c.CornerRadius = UDim.new(0, radius)
	c.Parent = obj
end

-- Automatically calculate scaled width based on screen size
local function getScaledWidth()
	local screenWidth = workspace.CurrentCamera and workspace.CurrentCamera.ViewportSize.X or 1920
	return math.clamp(screenWidth * 0.18, 240, 380) -- adaptive width between 240-380px
end

function Notification:GetContainer()
	local gui = playerGui:FindFirstChild("NotificationUI")
	if not gui then
		gui = Instance.new("ScreenGui")
		gui.Name = "NotificationUI"
		gui.IgnoreGuiInset = true
		gui.ResetOnSpawn = false
		gui.Parent = playerGui
	end

	local container = gui:FindFirstChild("Container")
	if not container then
		container = Instance.new("Frame")
		container.Name = "Container"
		container.BackgroundTransparency = 1
		container.AnchorPoint = Vector2.new(1, 1)
		container.Position = UDim2.new(1, -20, 1, -20)
		container.Size = UDim2.new(0, getScaledWidth(), 1, -40)
		container.Parent = gui

		local layout = Instance.new("UIListLayout")
		layout.Padding = UDim.new(0, 8)
		layout.SortOrder = Enum.SortOrder.LayoutOrder
		layout.HorizontalAlignment = Enum.HorizontalAlignment.Right
		layout.VerticalAlignment = Enum.VerticalAlignment.Bottom
		layout.Parent = container

		-- update size when screen resizes
		workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(function()
			container.Size = UDim2.new(0, getScaledWidth(), 1, -40)
		end)
	end

	return container
end

function Notification:Show(data)
	local container = self:GetContainer()
	local title = data.Title or "Notification"
	local text = data.Text or ""
	local icon = data.Icon or ""
	local duration = data.Duration or 4
	local bgColor = data.Background or Color3.fromRGB(25, 25, 25)
	local textColor = data.TextColor or Color3.fromRGB(255, 255, 255)

	local frame = Instance.new("Frame")
	frame.Size = UDim2.new(1, 0, 0, math.clamp(workspace.CurrentCamera.ViewportSize.Y * 0.08, 60, 100))
	frame.BackgroundColor3 = bgColor
	frame.BorderSizePixel = 0
	frame.ClipsDescendants = true
	frame.Parent = container
	makeCorner(frame, 10)

	local accent = Instance.new("Frame")
	accent.Size = UDim2.new(0, 4, 1, 0)
	accent.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
	accent.BorderSizePixel = 0
	accent.Parent = frame
	makeCorner(accent, 4)

	if icon and icon ~= "" then
		local iconLabel = Instance.new("ImageLabel")
		iconLabel.Image = icon
		iconLabel.Size = UDim2.new(0, 40, 0, 40)
		iconLabel.Position = UDim2.new(0, 10, 0, 10)
		iconLabel.BackgroundTransparency = 1
		iconLabel.Parent = frame
	end

	local titleLabel = Instance.new("TextLabel")
	titleLabel.BackgroundTransparency = 1
	titleLabel.Position = UDim2.new(0, 60, 0, 8)
	titleLabel.Size = UDim2.new(1, -70, 0, 20)
	titleLabel.Font = Enum.Font.SourceSansBold
	titleLabel.TextSize = 18
	titleLabel.TextColor3 = textColor
	titleLabel.TextXAlignment = Enum.TextXAlignment.Left
	titleLabel.Text = title
	titleLabel.Parent = frame

	local messageLabel = Instance.new("TextLabel")
	messageLabel.BackgroundTransparency = 1
	messageLabel.Position = UDim2.new(0, 60, 0, 30)
	messageLabel.Size = UDim2.new(1, -70, 1, -40)
	messageLabel.Font = Enum.Font.SourceSans
	messageLabel.TextSize = 14
	messageLabel.TextWrapped = true
    messageLabel.TextScaled = true
	messageLabel.TextColor3 = textColor
	messageLabel.TextXAlignment = Enum.TextXAlignment.Left
	messageLabel.TextYAlignment = Enum.TextYAlignment.Top
	messageLabel.Text = text
	messageLabel.Parent = frame

	frame.Position = UDim2.new(1, getScaledWidth() + 10, 0, 0)
	frame.BackgroundTransparency = 1
	TweenService:Create(frame, TweenInfo.new(0.25), {
		Position = UDim2.new(0, 0, 0, 0),
		BackgroundTransparency = 0
	}):Play()

	if data.OnClicked then
		frame.InputBegan:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				pcall(data.OnClicked)
			end
		end)
	end

	task.spawn(function()
		task.wait(duration)
		local tween = TweenService:Create(frame, TweenInfo.new(0.25), {
			BackgroundTransparency = 1,
			Position = UDim2.new(1, getScaledWidth() + 10, 0, 0)
		})
		tween:Play()
		tween.Completed:Wait()
		frame:Destroy()
	end)
end

return setmetatable({}, Notification)
